rules_version = '2';

service firebase.storage {
  match /b/{bucket}/o {
    
    // Default deny all access
    match /{allPaths=**} {
      allow read, write: if false;
    }

    // Allow public read access to all files so they can be displayed in the app
    match /{folder}/{fileName} {
      allow get: if true;
    }

    // Restrict writes to authenticated users and specific folders
    match /{folder}/{fileName} {
      // User must be authenticated to upload any file
      allow write: if request.auth != null
        // File size must be less than 10MB
        && request.resource.size < 10 * 1024 * 1024
        // File must be an image
        && request.resource.contentType.matches('image/.*')
        // Folder must be one of the allowed types
        && folder in ['profile-pictures', 'event-banners', 'community-logos', 'community-banners', 'deal-images', 'sponsor-logos', 'business-images'];
    }
  }
}
